
/* jquery.cytoscape-navigator.min.js */

/**
 * This file is part of cytoscape.js 2.0.3.
 * 
 * Cytoscape.js is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * Cytoscape.js is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License along with
 * cytoscape.js. If not, see <http://www.gnu.org/licenses/>.
 */
 
!(function(b){var a=function(d,c){this._init(d,c)};a.prototype={constructor:a,_init:function(d,c){var e=this;this.$element=b(d);this.options=b.extend(true,{},b.fn.cytoscapeNavigator.defaults,c);this.cy=this.$element.cytoscape("get");this.width=this.$element.width();this.height=this.$element.height();this.boundingBox=this.cy.elements().boundingBox();this._initPanel();this._initThumbnail();this._initView();this._initOverlay();this.$element.on("resize",b.proxy(this.resize,this))},destroy:function(){this.$panel.remove();
this.$element.removeData("navigator")},_initPanel:function(){var c=this.options;if(c.container){if(c.container instanceof jQuery){if(c.container.length>0){this.$panel=c.container.first()}else{b.error("Container for jquery.cyNavigator is empty");return}}else{if(b(c.container).length>0){this.$panel=b(c.container).first()}else{b.error("There is no any element matching your selector for jquery.cyNavigator");return}}}else{this.$panel=b('<div class="cytoscape-navigator"/>');this.$element.append(this.$panel)
}this._setupPanel()},_setupPanel:function(){var c=this.options;this.$panel.w=this.$panel.width();this.$panel.h=this.$panel.height()},_initThumbnail:function(){this.$thumbnail=b("<canvas/>");this.$panel.append(this.$thumbnail);this._setupThumbnailSizes();this._setupThumbnail();this.cy.on("initrender",b.proxy(this._checkThumbnailSizesAndUpdate,this));if(this.options.thumbnailLiveFramerate===false){this._hookGraphUpdates()}else{this._setGraphUpdatesTimer()}},_setupThumbnail:function(){this.$thumbnail.attr("width",this.$panel.w);
this.$thumbnail.attr("height",this.$panel.h);this._updateThumbnailImage()},_setupThumbnailSizes:function(){this.boundingBox=this.cy.elements().boundingBox();this.$thumbnail.zoom=Math.min(this.$panel.h/this.boundingBox.h,this.$panel.w/this.boundingBox.w);this.$thumbnail.pan={x:(this.$panel.w-this.$thumbnail.zoom*(this.boundingBox.x1+this.boundingBox.x2))/2,y:(this.$panel.h-this.$thumbnail.zoom*(this.boundingBox.y1+this.boundingBox.y2))/2}},_checkThumbnailSizesAndUpdate:function(){var d=this.$thumbnail.zoom,e=this.$thumbnail.pan.x,c=this.$thumbnail.pan.y;
this._setupThumbnailSizes();if(d!=this.$thumbnail.zoom||e!=this.$thumbnail.pan.x||c!=this.$thumbnail.pan.y){this._setupThumbnail();this._setupView()}else{this._updateThumbnailImage()}},_initView:function(){var c=this;this.$view=b('<div class="cytoscape-navigatorView"/>');this.$panel.append(this.$view);this.$view.borderTop=parseInt(this.$view.css("border-top-width"),10);this.$view.borderRight=parseInt(this.$view.css("border-right-width"),10);this.$view.borderBottom=parseInt(this.$view.css("border-bottom-width"),10);
this.$view.borderLeft=parseInt(this.$view.css("border-left-width"),10);this.$view.borderHorizontal=this.$view.borderLeft+this.$view.borderRight;this.$view.borderVertical=this.$view.borderTop+this.$view.borderBottom;this._setupView();this.cy.on("zoom pan",b.proxy(this._setupView,this))},_setupView:function(){if(this.$view.locked){return}var d=this.cy.zoom(),c=this.cy.pan();this.$view.w=this.width/d*this.$thumbnail.zoom;this.$view.x=-c.x*this.$view.w/this.width+this.$thumbnail.pan.x-this.$view.borderLeft;
this.$view.h=this.height/d*this.$thumbnail.zoom;this.$view.y=-c.y*this.$view.h/this.height+this.$thumbnail.pan.y-this.$view.borderTop;this.$view.width(this.$view.w).height(this.$view.h).css({left:this.$view.x,top:this.$view.y})},_initOverlay:function(){this.$overlay=b('<div class="cytoscape-navigatorOverlay"/>');this.$panel.append(this.$overlay);this.$overlay.hookPoint={x:0,y:0};this._initEventsHandling()},resize:function(){this.width=this.$element.width();this.height=this.$element.height();this._setupPanel();
this._checkThumbnailSizesAndUpdate();this._setupView()},_initEventsHandling:function(){var d=this,e=["mousedown","mousewheel","DOMMouseScroll","touchstart"],c=["mouseup","mouseout","mousemove","touchmove","touchend"];this.$overlay.on(e.join(" "),function(f){if(f.type=="touchstart"){f.offsetX=d.$view.x+d.$view.w/2;f.offsetY=d.$view.y+d.$view.h/2}if(f.offsetX===undefined||f.offsetY===undefined){var g=b(f.target).offset();f.offsetX=f.pageX-g.left;f.offsetY=f.pageY-g.top}if(f.type=="mousedown"||f.type=="touchstart"){d._eventMoveStart(f)
}else{if(f.type=="mousewheel"||f.type=="DOMMouseScroll"){d._eventZoom(f)}}return false});b("body").on(c.join(" "),function(f){if(!d.$overlay.inMovement){return}if(f.type=="touchend"){f.offsetX=d.$view.x+d.$view.w/2;f.offsetY=d.$view.y+d.$view.h/2}else{if(f.type=="touchmove"){f.pageX=f.originalEvent.touches[0].pageX;f.pageY=f.originalEvent.touches[0].pageY}}if(f.offsetX===undefined||f.offsetY===undefined){var h=b(f.target).offset();f.offsetX=f.pageX-h.left;f.offsetY=f.pageY-h.top}if(f.target!==d.$overlay[0]){var h=b(f.target).offset(),g=d.$overlay.offset();
f.offsetX=f.offsetX-g.left+h.left;f.offsetY=f.offsetY-g.top+h.top}if(f.type=="mousemove"||f.type=="touchmove"){d._eventMove(f)}else{if(f.type=="mouseup"||f.type=="touchend"){d._eventMoveEnd(f)}}return false})},_eventMoveStart:function(d){var c=new Date().getTime();if(this.$overlay.lastMoveStartTime&&this.$overlay.lastMoveStartTime+this.options.dblClickDelay>c){this.$overlay.lastMoveStartTime=0;this.$overlay.inMovement=true;this.$overlay.hookPoint.x=this.$view.w/2;this.$overlay.hookPoint.y=this.$view.h/2;
if(this.options.viewLiveFramerate!==false){this._eventMove({offsetX:this.$panel.w/2,offsetY:this.$panel.h/2})}else{this._eventMoveEnd({offsetX:this.$panel.w/2,offsetY:this.$panel.h/2})}this.$overlay.inMovement=false}else{this.$overlay.lastMoveStartTime=c;this.$overlay.inMovement=true;this.$view.locked=true;if(d.offsetX>=this.$view.x&&d.offsetX<=this.$view.x+this.$view.w&&d.offsetY>=this.$view.y&&d.offsetY<=this.$view.y+this.$view.h){this.$overlay.hookPoint.x=d.offsetX-this.$view.x;this.$overlay.hookPoint.y=d.offsetY-this.$view.y
}else{this.$overlay.hookPoint.x=this.$view.w/2;this.$overlay.hookPoint.y=this.$view.h/2;this._eventMove(d)}}},_eventMove:function(d){var c=this;this._checkMousePosition(d);if(!this.$overlay.inMovement){return}this.$view.x=d.offsetX-this.$overlay.hookPoint.x;this.$view.y=d.offsetY-this.$overlay.hookPoint.y;this.$view.css("left",this.$view.x);this.$view.css("top",this.$view.y);if(this.options.viewLiveFramerate!==false){if(this.options.viewLiveFramerate==0){this._moveCy()}else{if(!this.$overlay.timeout){this.$overlay.timeout=setTimeout(function(){c._moveCy();
c.$overlay.timeout=false},1000/this.options.viewLiveFramerate)}}}},_checkMousePosition:function(c){if(c.offsetX>this.$view.x&&c.offsetX<this.$view.x+this.$view.borderHorizontal+this.$view.w&&c.offsetY>this.$view.y&&c.offsetY<this.$view.y+this.$view.borderVertical+this.$view.h){this.$panel.addClass("mouseover-view")}else{this.$panel.removeClass("mouseover-view")}},_eventMoveEnd:function(c){this.$view.locked=false;this.$panel.removeClass("mouseover-view");if(!this.$overlay.inMovement){return}this._eventMove(c);
if(this.options.viewLiveFramerate===false){this._moveCy()}this.$overlay.inMovement=false},_eventZoom:function(d){var c=Math.pow(10,d.originalEvent.wheelDeltaY/1000||d.originalEvent.wheelDelta/1000||d.originalEvent.detail/-32),e={left:d.offsetX,top:d.offsetY};if(this.cy.zoomingEnabled()){this._zoomCy(c,e)}},_hookGraphUpdates:function(){this.cy.on("position add remove data",b.proxy(this._checkThumbnailSizesAndUpdate,this,false))},_setGraphUpdatesTimer:function(){var c=1000/this.options.thumbnailLiveFramerate,d=this,e=function(){setTimeout(function(){d._checkThumbnailSizesAndUpdate(true);
e()},c)};e()},_updateThumbnailImage:function(e){var c=this,d=0;if(!e&&this.options.thumbnailEventFramerate>0){d=~~(1000/this.options.thumbnailEventFramerate)}if(this._thumbnailUpdateTimeout===undefined||this._thumbnailUpdateTimeout===null){this._thumbnailUpdateTimeout=setTimeout(function(){c.cy.renderTo(c.$thumbnail[0].getContext("2d"),c.$thumbnail.zoom,c.$thumbnail.pan);c._thumbnailUpdateTimeout=null},d)}},_moveCy:function(){this.cy.pan({x:-(this.$view.x+this.$view.borderLeft-this.$thumbnail.pan.x)*this.width/this.$view.w,y:-(this.$view.y+this.$view.borderLeft-this.$thumbnail.pan.y)*this.height/this.$view.h})
},_zoomCy:function(d,c){var e,f=false;if(c){f=(c.left>this.$view.x)&&(c.left<this.$view.x+this.$view.w+this.$view.borderHorizontal)&&(c.top>this.$view.y)&&(c.top<this.$view.y+this.$view.h+this.$view.borderVertical)}if(c&&f){e={x:(c.left-this.$view.x-this.$view.borderLeft)*this.width/this.$view.w,y:(c.top-this.$view.y-this.$view.borderTop)*this.height/this.$view.h}}else{e={x:this.width/2,y:this.height/2}}this.cy.zoom({level:this.cy.zoom()*d,position:e})}};b.fn.cytoscapeNavigator=function(c){var d=arguments;
return this.each(function(){var g=b(this),f=g.data("navigator"),e=typeof c=="object"&&c;if(!f){g.data("navigator",(f=new a(this,e)))}if(typeof c=="string"){if(f[c]===undefined){b.error("cyNavigator has no such method")}else{if(typeof f[c]!==typeof function(){}){b.error("cyNavigator."+c+" is not a function")}else{if(c.charAt(0)=="_"){b.error("cyNavigator."+c+" is a private function")}else{f[c].call(f,Array.prototype.slice.call(d,1))}}}}})};b.fn.cytoscapeNavigator.Constructor=a;b.fn.cytoscapeNavigator.defaults={container:false,viewLiveFramerate:0,thumbnailEventFramerate:10,thumbnailLiveFramerate:false,dblClickDelay:200};
b.fn.cyNavigator=b.fn.cytoscapeNavigator})(jQuery);